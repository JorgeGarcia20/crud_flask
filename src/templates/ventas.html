{% extends 'layout.html' %}
{% include 'navbar.html'%}
{% block body %}

<div class="row">
  <div class="col-md-6">
    <div class="card card-body">
      <h1 class="text-center mb-4">Nueva venta</h1>

      <form action="/agregar_producto" method='POST'>
        <input type="hidden" name="csrf_token" value="{{csrf_token()}}">

        <div class="form-group mb-2">
          <label for="nombre" class="form-label">Nombre del cliente</label>
          <input class="form-control" type="text" name="nombre" value="{{ current_user.nombre }}">
        </div>
        <div class="form-group mb-2">
          <label for="apellidos" class="form-label">Apellidos del cliente</label>
          <input class="form-control" type="text" name="apellidos" value="{{ current_user.apellidos }}">
        </div>
        <div class="form-group mb-2">
          <label for="correo" class="form-label">Correo del cliente</label>
          <input class="form-control" type="text" name="correo" value="{{ current_user.correo }}">
        </div>
        <div class="form-group mb-2">
          <label for="rfc" class="form-label">RFC</label>
          <input class="form-control" type="text" name="rfc" value="{{ current_user.rfc }}">
        </div>
        <div class="form-group mb-2">
          <label for="direccion" class="form-label">Direccion</label>
          <input class="form-control" type="text" name="correo" value="{{ current_user.direccion }}">
        </div>

        <div>
          <label for="factura">Â¿Factura?</label><br>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="factura">
            <label class="form-check-label" for="factura">
              Si
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="factura" checked>
            <label class="form-check-label" for="factura">
              No
            </label>
          </div>
        </div>

        <table class="table table-striped table-hover table-bordered table-sm bg-white">
          <thead>
            <tr class="text-center">
              <td>Nombre</td>
              <td>Categoria</td>
              <td>Acciones</td>
            </tr>
          </thead>
          <tbody>
            <tr class="text-center">
              <td id="campo_nombre"></td>
              <td id="campo_categoria"></td>
              <td>
                <button class="btn btn-success">
                  Quitar
                </button>
              </td>
            </tr>
          </tbody>
          <tbody>
            <td>Total</td>
            <td id="campo_total"></td>
          </tbody>
        </table>

        <div class="form-group mb-2">
          <label for="total" class="form-label">Total</label>
          <input class="form-control" type="text" name="Total">
        </div>
        <div class="text-center mt-4">
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card card-body">
      <h1 class="text-center">Productos</h1>
      <table class="table table-striped table-hover table-bordered table-sm bg-white">
        <thead>
          <tr class="text-center">
            <td>Nombre</td>
            <td>Categoria</td>
            <td>Precio</td>
            <td>Acciones</td>
          </tr>
        </thead>
        <tbody>
          {% for p in data.productos %}
          <tr class="text-center">
            <td>{{p.id_producto}}</td>
            <td>{{p.id_categoria}}</td>
            <td>{{p.precio}}</td>
            <td>
              <button class="btn btn-success" onclick="sendRequest()">
                Comprar
              </button>
            </td>
            <script>
              function sendRequest() {
                let = aux = 0;

                let request = new XMLHttpRequest();
                request.open("GET", "/agregar/{{p.id_producto}}", true);
                request.send();
                request.onreadystatechange = function () {
                  if (this.readyState == 4 && this.status == 200) {
                    console.log(this.responseText)
                    const producto = JSON.parse(this.responseText)
                    //for (item of producto) {
                    console.log(producto)

                    //}
                    //document.getElementById('campo_nombre').innerHTML = producto.nombre
                    //document.getElementById('campo_categoria').innerHTML = producto.categoria
                    //aux = parseFloat(producto.precio) + aux;
                    //document.getElementById('campo_total').innerHTML = aux
                  }
                }
              }
            </script>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block customJS %}
{% endblock %}